---
# =============================================================================
#  Author : Martin AUBEUT
#  Ansible Playbook — Provisionnement complet serveur (standard)
#  Usage : ansible-playbook -i inventory.ini site.yml
#  Version : 1.0 (2025-19-02)
#  Modification :
#  - 2025-19-02 - Initial version
# =============================================================================

- name: Full server provisioning
  hosts: all
  become: true

  pre_tasks:
    - name: Verify target OS is Debian/Ubuntu
      assert:
        that:
          - ansible_os_family == "Debian"
        fail_msg: "Ce playbook est prévu pour Debian/Ubuntu uniquement"

- import_playbook: hostname.yml
- import_playbook: user.yml
- import_playbook: ufw.yml
- import_playbook: ssh_hardening.yml
- import_playbook: fail2ban.yml
- import_playbook: sysctl_hardening.yml
- import_playbook: auditd.yml
- import_playbook: pam_hardening.yml
- import_playbook: anti-malware.yml
- import_playbook: banner.yml
- import_playbook: pkg_integrity.yml
- import_playbook: process_accounting.yml
- import_playbook: aide.yml
# Décommenter uniquement après vérification des modules chargés :
# - import_playbook: kernel_modules_lock.yml